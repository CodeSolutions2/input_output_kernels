<!DOCTYPE html>
<html>
<head></head>
<body>  


<input id="url" type="text" value="" placeholder="url" rows="10" cols="100" style="display:block; text-align: left; width: 600px;">
	
<button id="run_selection" onclick="run_selection()">run_selection</button>

<div id="output">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/knn-classifier"></script>

	
<script>

// -----------------------------------------------

async function run_selection() {
	
  const url = document.getElementById('url').value;
  const data_str = await call_fetch_method(url);

  const ys_selected_ColNum = [4];
  const headerORnot = "no_header";
  var [xs, ys] = await parse_text_to_array(data_str, ys_selected_ColNum, headerORnot);
	

  document.getElementById("output").innerHTML = "xs and ys row sample: "+xs.at(0).toString()+ys.at(0).toString();
  document.getElementById("output").innerHTML += "<br>";

  // Create a KNN model
  const row = xs.length;

const classifier = knnClassifier.create();

document.getElementById("output").innerHTML += "classifier: "+classifier;
document.getElementById("output").innerHTML += "<br>";

for (var i=0; i<row; i++) {
  classifier.addExample(tf.tensor(xs.at(i)), ys.at(i));
}

document.getElementById("output").innerHTML += "finished adding samples";
document.getElementById("output").innerHTML += "<br>";

const index = Number(Math.floor(Math.random()*row));
document.getElementById("output").innerHTML += "index: "+index;
document.getElementById("output").innerHTML += "<br>";

const test_input = xs.at(index);
document.getElementById("output").innerHTML += "test_input: "+test_input;
document.getElementById("output").innerHTML += "<br>";

const result = await classifier.predictClass(tf.tensor(test_input));
document.getElementById("output").innerHTML += "result: "+result;
document.getElementById("output").innerHTML += "<br>";

// const result_js0 = await result.data();
// document.getElementById("output").innerHTML += "result0: "+JSON.stringify(result_js0);
// document.getElementById("output").innerHTML += "<br>";
// OR
const result_js1 = await JSON.stringify(result);
document.getElementById("output").innerHTML += "result1: "+result_js1;
document.getElementById("output").innerHTML += "<br>";

const out = await classifier.getClassExampleCount();
document.getElementById("output").innerHTML += "Count of classes for model: "+JSON.stringify(out);
document.getElementById("output").innerHTML += "<br>";

} // end of run_selection
  

</script>
</body>
</html>