<!DOCTYPE html>
<html>
<head></head>
<body>


<button id="run_selection" onclick="run_selection()" style="display:block;">Run Selection</button>

<div id="output">

<div id="data_display" style="display:block;text-align:left;width:600px;"></div>

<canvas id="canvasElement_id" width="10" height="10" style="display:block;"></canvas>

<style>
canvas {border: 1px solid black; position: absolute; display: inline-block; z-index: 0; top: 100px}
</style>


<script>

const canvasElement = document.getElementById("canvasElement_id");
const ctx = canvasElement.getContext("2d");

var width = canvasElement.width;
var height = canvasElement.height;


async function run_selection() {

  // Obtain a TypedArray from the canvas.
  const TypedArray = await ctx.getImageData(0, 0, width, height);


  // Put the array on the canvas.
  const imageData = await new ImageData(TypedArray, width, height);
  ctx.putImageData(imageData, 0, 0);


  // ImageArray is a 1d array with interleaved [r, g, b, alpha] values.
  // var ImageArray = TypedArray.data;
  // OR
  var ImageArray = await Array.from(TypedArray.data);
  document.getElementById("output").innerHTML = "ImageArray.length: "+ImageArray.length+"<br>";


  // Create a 2darray.
  var n = width;
  var arr2d = await Array.from({length: n}, (row,irow) => { return Array.from({length: n}, (v,i) => { return (irow == i) ? 1 : 0; }); });
  document.getElementById("output").innerHTML = "arr2d: "+arr2d+"<br>";
  

  // Transform 2darray to an ImageArray.
  var arr2d_flat = await arr2d.flat(Infinity);
  document.getElementById("output").innerHTML = "arr2d_flat: "+arr2d_flat+"<br>";
  const color_name =["r", "g", "b", "alpha"];
  var c = 0;
  for (var i=0; i<ImageArray.length; i+=color_name.length) {
    ImageArray[i] = 0; // red
    ImageArray[i+1] = 0; // green
    ImageArray[i+2] = (c < arr2d_flat.length) ? arr2d_flat.at(c) : 0; // blue
    ImageArray[i+3] = 0;  //alpha
    c = c + 1;
  }
  var TypedArray = await new Uint8ClampedArray(ImageArray);
  

  // Put the array on the canvas.
  var imageData = await new ImageData(TypedArray, width, height);
  ctx.putImageData(imageData, 0, 0);

}



</script>
</body>
</html>
