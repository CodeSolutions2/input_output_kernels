<!DOCTYPE html>
<html>
<head></head>
<body>


<button id="run_selection" onclick="run_selection()" style="display:block;">Run Selection</button>

<div id="output">

<div id="data_display" style="display:block;text-align:left;width:600px;"></div>

<canvas id="canvasElement_id" width="10" height="10" style="display:block;"></canvas>

<script>



const canvasElement = document.getElementById("canvasElement_id");
const ctx = canvasElement.getContext("2d");

var width = canvasElement.width;
var height = canvasElement.height;


async function run_selection() {

  
  // [0] Initialize the canvas to display the array data.
  var ImageArray = await Initialize_canvas();

  // [1] Create a 2darray.
  var n = width;
  var arr2d = Array.from({length: n}, (row,irow) => { return Array.from({length: n}, (v,i) => { return (irow == i) ? 1 : 0; }); });
  document.getElementById("output").innerHTML = arr2d+"<br>";

  // Transform 2darray to an ImageArray.
  const TypedArray = await update_canvas_data(ImageArray, arr2d);
  document.getElementById("output").innerHTML = TypedArray+"<br>";

  // Put the array on the canvas.
  const imageData = await new ImageData(TypedArray, width, height);
  ctx.putImageData(imageData, 0, 0);

  // Grayscale.


}







async function update_canvas_data(ImageArray, arr2d) {

  const color_name =["r", "g", "b", "alpha"];
  
  var c = 0;

  for (var i=0; i<ImageArray.length; i+=color_name.length) {
    ImageArray[i] = 0; // red
    ImageArray[i+1] = 0; // green
    ImageArray[i+2] = arr2d.at(c); // blue
    ImageArray[i+3] = 0;  //alpha
    c = c + 1;
  }

  // Returns a TypedArray.
  var TypedArray = new Uint8ClampedArray(ImageArray);

  return TypedArray;

}




async function Initialize_canvas() {

  // Obtain a TypedArray from the canvas.
  const uint8ClampedArray = ctx.getImageData(0, 0, width, height);
  
  // ImageArray is a 1d array with inyerleaved [r, g, b, alpha] values.
  // var ImageArray = uint8ClampedArray.data;
  // OR
  var ImageArray = Array.from(uint8ClampedArray.data);

  return ImageArray;
}




//async function grayscale(arr2d) {
 
  //var grayscale = [];
 
  //for (var i=0; i<arr2d.length; i++) {
  //  var result = arr2d[i].map((v,j) => {
  //    ret
   // });
  //  grayscale.push(result);
//  }

//  return grayscale;
//}



</script>
</body>
</html>
