<!DOCTYPE html>
<html>
<head></head>
<body>

<button id="run_selection" onclick="run_selection()">run_selection</button>

<div id="output">


<script>


async function run_selection() {

  var text= "the text processing of text is useful. text processing is fun.";

  
  const X = await CountVectorization(text);
  document.getElementById("output").innerHTML = "X: "+X.toString();
  document.getElementById("output").innerHTML += "<br>";



}


async function CountVectorization(text) {

  var sentences = text.split('.').filter((x) => x != "");
  document.getElementById("output").innerHTML = "sentences: "+sentences.toString();
  document.getElementById("output").innerHTML += "<br>";

  // Remove stopwords from sentences.
  var stopwords = ["and", "is", "the", "of", "to"];
  sentences = sentences.map((sval, sind) => {
    sval = sval.split(' ').map((val, ind) => {
      var temp = val;
      for (var i=0; i<stopwords.length; i++){
        if (val == stopwords.at(i)) { temp = ''; }
      }
      return temp;
    }).filter((x) => x != "");
    return sval.join(" ");
  });
  document.getElementById("output").innerHTML = "remove stopwords - sentences: "+sentences.toString();
  document.getElementById("output").innerHTML += "<br>";

  // Obtain unique words 
  var words = sentences.map((val, ind) => { return val.split(" "); }).flat(Infinity).filter((x) => x != "").toLowerCase();
  words = [... new Set(words)];
  document.getElementById("output").innerHTML = "words: "+words.toString();
  document.getElementById("output").innerHTML += "<br>";

  // Create count matrix
  var keys = words;
  var X = [];
  for (var i=0; i<sentences.length; i++){
    var word_arr = sentences.at(i).split(" ");
    var row = [];
    var c = 0;
    var values = words.map((val, ind) => { return 0; });

    // Counter: count the repeating words per sentence
    var word_arr_uq = [... new Set(word_arr)];

    for (var j=0; j<word_arr_uq.length; j++) {
      var out = word_arr.map((val, ind) => {
        if (word_arr_uq.at(j) == val) { return 1; } else { return 0; }
      });
      
      var sum_out = out.reduce((acc, cur) => acc+cur, 0);
      // console.log("sum_out: ", sum_out);

      var ii = keys.findIndex((x) => x == word_arr_uq.at(j));
      values[ii] = values.at(ii) + sum_out;
      
    } // end of Counter function 
    
    for (var j=0; j<words.length; j++){
      if (words.at(j) == keys.at(c)){
        var index = keys.findIndex((x) => x == keys.at(c));
        row.push(values.at(index));
        c = c + 1;
      } else {
        row.push(0);
      }
    } // end of for loop words.length
    
    X.push(row);

  } // end of sentences loop
  
  return X;
} // end of function




</script>
</body>
</html>
